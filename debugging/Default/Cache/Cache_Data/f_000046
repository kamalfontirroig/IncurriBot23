"use strict";(self.webpackChunkppm=self.webpackChunkppm||[]).push([[8269],{24160:(H,C,e)=>{e.d(C,{L:()=>y});class y{}},39853:(H,C,e)=>{e.d(C,{L:()=>y});class y{constructor(S,a,A,t,P){this.broken=S,this.completed=a,this.phaseAffected=A,this.progress=t,this.total=P}}},70676:(H,C,e)=>{e.d(C,{f:()=>U});var y=e(21642),g=e(69989),S=e(683),a=(()=>((a||(a={})).DATA_INCONSISTENT="DATA_INCONSISTENT",a))(),A=e(35059),t=e(59942),P=e(84046);let U=(()=>{class f{constructor(I,L){this.jiraIndexCorruptedWarningDialogCreatorService=I,this.jiraIndexCorruptedStorageService=L}handle(I){return I instanceof y.U&&this.isJiraIndexCorruptedError(I)&&this.handleJiraIndexCorruptedError(),(0,g._)(I)}isJiraIndexCorruptedError(I){return I.status===S.o.UNPROCESSABLE_ENTITY&&I.error===a.DATA_INCONSISTENT}handleJiraIndexCorruptedError(){this.jiraIndexCorruptedStorageService.set(!0),this.jiraIndexCorruptedWarningDialogCreatorService.createComponent()}}return f.\u0275fac=function(I){return new(I||f)(P.LFG(A.a),P.LFG(t.T))},f.\u0275prov=P.Yz7({token:f,factory:f.\u0275fac}),f})()},15750:(H,C,e)=>{e.d(C,{z:()=>E});var y=e(17314),g=e(98223);class S{constructor(d,$){this.countOfBoxes=d,this.countOfSyncedBoxes=$}}var a=e(6248),A=e(77535),t=e(88004),P=e(76723),U=e(97589),f=e(39075),O=e(57260),I=e(18840),L=e(71726),D=e(83941),m=e(68859),G=e(46902),T=e(78609),s=e(9829),c=e(84046),p=e(30713),R=e(96085),l=e(83950),N=e(25673),B=e(73455),M=e(14102),z=e(24160);class E extends P.l{constructor(d,$,k,W,n,h,i,v,w,b,F,Y,J,Q){super(),this.progressCreatorService=d,this.repository=$,this.repeater=k,this.infoResource=W,this.environmentService=n,this.boxHierarchyService=h,this.navigationService=i,this.messageService=v,this.reloadService=w,this.injector=b,this.boxApplicationModuleTypeStorage=F,this.wbs=Y,this.gadgetController=J,this.window=Q,this.moduleNewStrategyAcceptance$=new I.X(!1),this.completedBoxesCount=0,this.boxIds=[],this.isModalOpened=!1,this.observeBoxApplicationActiveModule()}checkStatus(d){return this.infoResource.checkProgress(d)}run(d){this.updateInProgressBoxIds(d),this.updateInProgressBoxes(),!this.progressStatus$&&(this.moduleNewStrategyAcceptance$.getValue()||this.showProgressModal(),this.observeProgressStatus(),this.repository.setStatus(a.g.SYNCING),this.start())}showProgressModal(){this.isModalOpened=!0,this.progressCreatorService.createComponent()}removeProgressModal(){!this.isModalOpened||(this.isModalOpened=!1,this.progressCreatorService.remove())}selectModuleNewStrategyAcceptance(){return this.moduleNewStrategyAcceptance$.asObservable()}observeBoxApplicationActiveModule(){this.boxApplicationModuleTypeStorage.select().pipe((0,L.U)(d=>E.NEW_STRATEGY_MODULES.includes(d)),this.takeUntilDestroy()).subscribe(d=>{!d&&this.completedBoxesCount>0?this.showProgressModal():this.removeProgressModal(),this.moduleNewStrategyAcceptance$.next(d)})}updateInProgressBoxIds(d){this.boxIds=[...this.boxIds,...d]}updateInProgressBoxes(){const d=new S(this.boxIds.length,this.completedBoxesCount);this.repository.setBoxes(d)}observeProgressStatus(){this.progressStatus$=this.repository.selectProgressStatus().subscribe(d=>{d.completed?this.onCompleteProgress():d.broken&&this.onBrokenProgress()})}onBrokenProgress(){this.finish(),this.showBrokenMessage()}onCompleteProgress(){this.increaseCompletedBoxesCount(),this.updateInProgressBoxes(),this.completedBoxesCount<this.boxIds.length?this.start():this.finish()}start(){this.repeater.start(this.boxIds[this.completedBoxesCount])}increaseCompletedBoxesCount(){this.completedBoxesCount++}finish(){this.repository.setStatus(a.g.COMPLETE),this.removeProgressModal(),this.resetData(),this.moduleNewStrategyAcceptance$.getValue()||this.onOldStrategyComplete()}onOldStrategyComplete(){this.window.spGadgetReload?this.reloadGadget():this.wbs?this.reloadWbs():this.reloadPage()}reloadGadget(){this.window.spGadgetReload()}reloadWbs(){this.wbs.refetchTasks()}reloadPage(){this.reloadService.execute()}resetData(){this.completedBoxesCount=0,this.boxIds=[],this.progressStatus$.unsubscribe(),this.progressStatus$=null}showBrokenMessage(){this.messageService.warning(this.getMessageForBrokenStatus())}getMessageForBrokenStatus(){const d=this.injector.get(g.e);return(new G.P).withDefaultsByStatus(s.r.WARNING).withPrimaryButton((new m.q.Builder).withBtnText(d.translate("SPT_BOX_STRUCTURE_SYNCHRONIZATION_BROKEN_STATUS_MESSAGE_FIRST_BUTTON_TEXT")).withBtnClickCallback(()=>this.navigationService.goToScopeDefinition(this.boxHierarchyService.getContextBoxId().toString()).navigation()).build()).withSecondaryButton((new m.q.Builder).withBtnText(d.translate("SPT_BOX_STRUCTURE_SYNCHRONIZATION_BROKEN_STATUS_MESSAGE_SECOND_BUTTON_TEXT")).withBtnClickCallback(()=>{const $=this.environmentService.getHelpURL("extplatform/connection-is-not-operational");this.window.open($,"_blank")}).build()).withTitle(d.translate("SPT_BOX_STRUCTURE_SYNCHRONIZATION_BROKEN_STATUS_MESSAGE_TITLE")).withBody(D.H.i18n("SPT_BOX_STRUCTURE_SYNCHRONIZATION_BROKEN_STATUS_MESSAGE_BODY"))}}E.NEW_STRATEGY_MODULES=[t._.GANTT,t._.BOARD,t._.SCOPE,t._.CALENDAR,t._.CONFIGURATION,t._.ROADMAP,t._.RESOURCES,t._.RISK],E.\u0275fac=function(d){return new(d||E)(c.LFG(f.C),c.LFG(p.T),c.LFG(U.U),c.LFG(R.$),c.LFG(l.L),c.LFG(N.T),c.LFG(B.M),c.LFG(T.e),c.LFG(M.f),c.LFG(c.zs3),c.LFG(A.N),c.LFG(O.F,8),c.LFG(z.L,8),c.LFG(y.m))},E.\u0275prov=c.Yz7({token:E,factory:E.\u0275fac})},39075:(H,C,e)=>{e.d(C,{C:()=>W});var y=e(24977),g=(()=>{return(n=g||(g={})).LOADING_OPTIMIZATION="LOADING_OPTIMIZATION",n.MISSING_TASKS="MISSING_TASKS",n.OBSOLETE_TASKS="OBSOLETE_TASKS",n.SCOPE_ADDITIONAL="SCOPE_ADDITIONAL",n.SCOPE_REGULAR="SCOPE_REGULAR",n.STRUCTURE="STRUCTURE",n.SYNCHRONIZERS_HIERARCHY="SYNCHRONIZERS_HIERARCHY",g;var n})();class S{constructor(h,i,v,w,b,F,Y){this.loadingOptimization=h,this.missingTasks=i,this.obsoleteTasks=v,this.scopeAdditional=w,this.scopeRegular=b,this.structure=F,this.synchronizersHierarchy=Y}static create(h){var i,v,w,b,F,Y,J;const Q=null!==(i=h[g.LOADING_OPTIMIZATION])&&void 0!==i?i:0,K=null!==(v=h[g.MISSING_TASKS])&&void 0!==v?v:0,q=null!==(w=h[g.OBSOLETE_TASKS])&&void 0!==w?w:0,_=null!==(b=h[g.SCOPE_ADDITIONAL])&&void 0!==b?b:0,o=null!==(F=h[g.SCOPE_REGULAR])&&void 0!==F?F:0,u=null!==(Y=h[g.STRUCTURE])&&void 0!==Y?Y:0,r=null!==(J=h[g.SYNCHRONIZERS_HIERARCHY])&&void 0!==J?J:0;return new S(Q,K,q,_,o,u,r)}}var a=e(4683),A=e(62546),t=e(84046),P=e(30713),U=e(55331),f=e(69001),O=e(88768),I=e(65799);function L(n,h){if(1&n){const i=t.EpF();t.TgZ(0,"i",8),t.NdJ("click",function(){return t.CHM(i),t.oxw(2).onCloseIconClick()}),t.qZA()}}function D(n,h){1&n&&(t.TgZ(0,"h2",9),t._uU(1),t.ALo(2,"spL10nText"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_HEADER_SINGLE")))}const m=function(n,h){return{syncedBoxes:n,numberOfBoxes:h}};function G(n,h){if(1&n&&(t.TgZ(0,"h2",9),t._uU(1),t.ALo(2,"spL10nText"),t.qZA()),2&n){const i=t.oxw(2);t.xp6(1),t.Oqu(t.xi3(2,1,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_HEADER_MULTIPLE",t.WLB(4,m,i.syncBoxes.countOfSyncedBoxes,i.syncBoxes.countOfBoxes)))}}function T(n,h){if(1&n&&t._UZ(0,"sp-digital-counter",10),2&n){const i=t.oxw(2);t.Q6J("value",null==i.syncProgressStatus?null:i.syncProgressStatus.progress)}}function s(n,h){1&n&&t._UZ(0,"i",11)}function c(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.scopeRegular),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_SCOPE_REGULAR")," ")}}function p(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.scopeAdditional),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_SCOPE_ADDITIONAL")," ")}}function R(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.loadingOptimization),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_LOADING_OPTIMIZATION")," ")}}function l(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.obsoleteTasks),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_OBSOLETE_TASKS")," ")}}function N(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.missingTasks),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_MISSING_TASKS")," ")}}function B(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.structure),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_STRUCTURE")," ")}}function M(n,h){if(1&n&&(t.TgZ(0,"li"),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t._uU(3),t.ALo(4,"spL10nText"),t.qZA()),2&n){const i=t.oxw(3);t.xp6(2),t.Oqu(i.syncProgress.synchronizersHierarchy),t.xp6(1),t.hij(" ",t.lcZ(4,2,"SPT_BOX_STRUCTURE_SYNCHRONIZATION_SYNCHRONIZERS_HIERARCHY")," ")}}function z(n,h){if(1&n&&(t.TgZ(0,"ul",12),t.YNc(1,c,5,4,"li",0),t.YNc(2,p,5,4,"li",0),t.YNc(3,R,5,4,"li",0),t.YNc(4,l,5,4,"li",0),t.YNc(5,N,5,4,"li",0),t.YNc(6,B,5,4,"li",0),t.YNc(7,M,5,4,"li",0),t.qZA()),2&n){const i=t.oxw(2);t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.scopeRegular)),t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.scopeAdditional)),t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.loadingOptimization)),t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.obsoleteTasks)),t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.missingTasks)),t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.structure)),t.xp6(1),t.Q6J("ngIf",i.isNumber(i.syncProgress.synchronizersHierarchy))}}function E(n,h){if(1&n&&(t.ynx(0),t.YNc(1,L,1,0,"i",1),t.YNc(2,D,3,3,"h2",2),t.YNc(3,G,3,7,"h2",2),t.TgZ(4,"div",3),t.TgZ(5,"sp-circle-loader",4),t.YNc(6,T,1,1,"sp-digital-counter",5),t.YNc(7,s,1,0,"ng-template",null,6,t.W1O),t.qZA(),t.YNc(9,z,8,7,"ul",7),t.qZA(),t.BQk()),2&n){const i=t.MAs(8),v=t.oxw();t.xp6(1),t.Q6J("ngIf",v.isSyncModuleAcceptsNewStrategy),t.xp6(1),t.Q6J("ngIf",1===v.syncBoxes.countOfBoxes),t.xp6(1),t.Q6J("ngIf",v.syncBoxes.countOfBoxes>1),t.xp6(3),t.Q6J("ngIf",!(null!=v.syncProgressStatus&&v.syncProgressStatus.broken))("ngIfElse",i),t.xp6(3),t.Q6J("ngIf",v.syncProgress&&!(null!=v.syncProgressStatus&&v.syncProgressStatus.broken))}}let X=(()=>{class n extends A.H{constructor(i,v,w,b,F){super(i,v),this.scopeSyncService=w,this.scopeSyncRepository=b,this.changeDetectorRef=F,this.isSyncModuleAcceptsNewStrategy=!1}ngOnInit(){this.domManipulator.setHostAttribute("id","sp-syncprogress-dialog"),this.observeSyncData(),this.observeModuleNewStrategyAcceptance()}isNumber(i){return"number"==typeof i}onCloseIconClick(){this.scopeSyncService.removeModal()}getHostClasses(){return["sp-scope-sync-progress","sp-relative","sp-w-full"]}observeSyncData(){(0,a.aj)([this.scopeSyncRepository.selectProgressStatus(),this.scopeSyncRepository.selectBoxes()]).pipe(this.takeUntilDestroy()).subscribe(([i,v])=>{this.syncBoxes=v,this.syncProgressStatus=i,this.syncProgress=S.create(this.syncProgressStatus.phaseAffected),this.changeDetectorRef.detectChanges()})}observeModuleNewStrategyAcceptance(){this.scopeSyncService.selectModuleNewStrategyAcceptance().pipe(this.takeUntilDestroy()).subscribe(i=>{this.isSyncModuleAcceptsNewStrategy=i,this.changeDetectorRef.detectChanges()})}}return n.\u0275fac=function(i){return new(i||n)(t.Y36(t.SBq),t.Y36(t.Qsj),t.Y36(y.h),t.Y36(P.T),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["sp-scope-sync-progress"]],features:[t.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["class","fa fa-times sp-absolute sp-top-0 sp-right-0 sp-mt-6 sp-text-gray-400 sp-text-xl sp-cursor-pointer",3,"click",4,"ngIf"],["class","sp-m-0 sp-mt-5",4,"ngIf"],[1,"sp-my-13","sp-flex","sp-items-center","sp-justify-center"],[1,"sp-scope-sync-progress__circle-loader"],[3,"value",4,"ngIf","ngIfElse"],["elseBlock",""],["class","sp-ml-14",4,"ngIf"],[1,"fa","fa-times","sp-absolute","sp-top-0","sp-right-0","sp-mt-6","sp-text-gray-400","sp-text-xl","sp-cursor-pointer",3,"click"],[1,"sp-m-0","sp-mt-5"],[3,"value"],["aria-hidden","true",1,"fa","fa-exclamation"],[1,"sp-ml-14"],[1,"sp-text-primary","sp-font-bold"]],template:function(i,v){1&i&&t.YNc(0,E,10,6,"ng-container",0),2&i&&t.Q6J("ngIf",v.syncBoxes)},directives:[U.O5,f._,O.Q],pipes:[I.L],styles:[".sp-scope-sync-progress__circle-loader{width:136px;height:136px}\n"],encapsulation:2,changeDetection:0}),n})();var d=e(86263),$=e(21693),k=e(23854);let W=(()=>{class n{constructor(i){this.modalWindowService=i}createComponent(){this.modalConfiguration=new d.g.Builder(X).withShortcuts(!1).withSize(k.e.L).build(),this.modalWindowService.open(this.modalConfiguration)}remove(){this.modalWindowService.close(this.modalConfiguration)}}return n.\u0275fac=function(i){return new(i||n)(t.LFG($.b))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})()},97589:(H,C,e)=>{e.d(C,{U:()=>D});var y=e(90850),g=e(49549),S=e(57958),a=e(35811),A=e(56385),t=e(70676),P=e(39853);class U extends P.L{constructor(){super(!1,!0,null,0,0)}}var f=e(84046),O=e(25673),I=e(30713),L=e(96085);let D=(()=>{class m{constructor(T,s,c,p){this.boxHierarchyService=T,this.scopeSyncRepository=s,this.scopeSyncInfoResource=c,this.scopeSyncErrorHandler=p,this.REQUEST_INTERVAL=400,this.completeRepeating$=new y.xQ}start(T){(0,g.H)(0,this.REQUEST_INTERVAL).pipe((0,S.b)(()=>this.scopeSyncInfoResource.checkProgress(T)),(0,a.R)(this.completeRepeating$),(0,A.K)(s=>(this.setProgressStatus(this.getBrokenProgressStatus()),this.completeRepeating$.next(),this.scopeSyncErrorHandler.handle(s)))).subscribe(s=>{this.isResponseDone(s)&&this.completeRepeating$.next(),this.setProgressStatus(s)})}isResponseDone(T){return T.broken||T.completed}setProgressStatus(T){this.scopeSyncRepository.setProgressStatus(T)}getBrokenProgressStatus(){return new U}}return m.\u0275fac=function(T){return new(T||m)(f.LFG(O.T),f.LFG(I.T),f.LFG(L.$),f.LFG(t.f))},m.\u0275prov=f.Yz7({token:m,factory:m.\u0275fac}),m})()},68269:(H,C,e)=>{e.d(C,{g:()=>_});var y=e(55331),g=e(41001),S=e(27609),a=e(84046);let A=(()=>{class o extends S.V{constructor(){super()}}return o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var t=e(90850);let P=(()=>{class o{constructor(){this.progressStatus$=new t.xQ}select(){return this.progressStatus$.asObservable()}set(r){this.progressStatus$.next(r)}}return o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var U=e(97589),f=e(15750),O=e(39075),I=e(6248);let L=(()=>{class o extends S.V{constructor(){super(I.g.NOT_STARTED)}}return o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var D=e(30713);let m=(()=>{class o extends D.T{constructor(r,x,Z){super(),this.progressStatusStorage=r,this.statusStorage=x,this.boxesStorage=Z}setStatus(r){this.statusStorage.set(r)}selectStatus(){return this.statusStorage.select()}setProgressStatus(r){this.progressStatusStorage.set(r)}selectProgressStatus(){return this.progressStatusStorage.select()}setBoxes(r){this.boxesStorage.set(r)}selectBoxes(){return this.boxesStorage.select()}}return o.\u0275fac=function(r){return new(r||o)(a.LFG(P),a.LFG(L),a.LFG(A))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var G=e(24977),T=e(76723),s=e(34373),c=e(41085),p=e(60903),R=e(17542),l=function(o,u,r,x){var V,Z=arguments.length,j=Z<3?u:null===x?x=Object.getOwnPropertyDescriptor(u,r):x;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)j=Reflect.decorate(o,u,r,x);else for(var tt=o.length-1;tt>=0;tt--)(V=o[tt])&&(j=(Z<3?V(j):Z>3?V(u,r,j):V(u,r))||j);return Z>3&&j&&Object.defineProperty(u,r,j),j},N=function(o,u){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,u)};class B extends R.M{constructor(){super()}getClassName(){return"ScopeSyncProgressStatusDTO"}}l([(0,s.si)(),N("design:type",Boolean)],B.prototype,"broken",void 0),l([(0,s.si)(),N("design:type",Boolean)],B.prototype,"completed",void 0),l([(0,c.ci)(),N("design:type",Object)],B.prototype,"phaseAffected",void 0),l([(0,p.qA)(),N("design:type",Number)],B.prototype,"progress",void 0),l([(0,p.qA)(),N("design:type",Number)],B.prototype,"total",void 0);var M=e(2421),z=e(83155),E=e(11531),X=e(83950);let d=(()=>{class o extends z.a{constructor(r,x){super(r),this.environmentService=x}checkProgress(r){return this.get(`${r}/syncStatus`).pipe((0,M.W)(B))}sync(r){return this.get(`${r}/sync`).pipe((0,M.W)(B))}forceSync(r){return this.get(`${r}/sync`,{force:!0}).pipe((0,M.W)(B))}getBoxesToSync(r){return this.get(`${r}/boxesToSync`)}getRestUrl(r){return`${this.environmentService.getRestBaseUrl()}ppm/boxarea/task/scope/${r}`}}return o.\u0275fac=function(r){return new(r||o)(a.LFG(E.O),a.LFG(X.L))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var $=e(11206),k=e(96085),W=e(71726),n=e(39853);let h=(()=>{class o{convert(r){return new n.L(r.broken,r.completed,r.phaseAffected,r.progress,r.total)}}return o.\u0275fac=function(r){return new(r||o)},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})(),i=(()=>{class o extends k.${constructor(r,x){super(),this.httpScopeSyncInfoResource=r,this.converter=x}checkProgress(r){return this.httpScopeSyncInfoResource.checkProgress(r.toString()).pipe((0,W.U)(x=>this.converter.convert(x)))}sync(r){return this.httpScopeSyncInfoResource.sync(r.toString()).pipe((0,W.U)(x=>this.converter.convert(x)))}forceSync(r){return this.httpScopeSyncInfoResource.forceSync(r.toString()).pipe((0,W.U)(x=>this.converter.convert(x)))}getBoxesToSync(r){return this.httpScopeSyncInfoResource.getBoxesToSync(r.toString()).pipe((0,W.U)(x=>x.map(Z=>new $.A(Z))))}}return o.\u0275fac=function(r){return new(r||o)(a.LFG(d),a.LFG(h))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var v=e(53425),w=e(12002),b=e(82263),F=e(51805),Y=e(37869),J=e(17314);let Q=(()=>{class o{constructor(r,x,Z){this.repository=r,this.document=x,this.window=Z}init(){this.setStatusModes()}setStatusModes(){this.window.SP=Object.assign({ScopeSync:{turnOnSyncingStatus:()=>this.repository.setStatus(I.g.SYNCING),turnOnCompleteStatus:()=>this.repository.setStatus(I.g.COMPLETE)}},this.window.SP)}}return o.\u0275fac=function(r){return new(r||o)(a.LFG(D.T),a.LFG(y.K0),a.LFG(J.m))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})(),K=(()=>{class o{constructor(r){this.scopeSyncDevToolsService=r}init(){this.scopeSyncDevToolsService.init()}}return o.\u0275fac=function(r){return new(r||o)(a.LFG(Q))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var q=e(70676);let _=(()=>{class o{constructor(r){r.init()}static forRoot(){return{ngModule:o,providers:[O.C,P,d,L,A,U.U,m,G.h,Q,q.f,K,h,{provide:T.l,useClass:f.z},{provide:k.$,useClass:i},{provide:D.T,useClass:m}]}}}return o.\u0275fac=function(r){return new(r||o)(a.LFG(K))},o.\u0275mod=a.oAB({type:o}),o.\u0275inj=a.cJS({imports:[[y.ez,w.K,F.$,b.Z.forRoot(),v.$,Y.o,g.J]]}),o})()},57260:(H,C,e)=>{e.d(C,{F:()=>G});var y=e(85105);let g=(()=>{class T{constructor(){}}return T.Builder=class extends y.I{build(){const c=new T;return c.fromNode=this.fromNode,c.toNode=this.toNode,c.toIndex=this.toIndex,c}withFromNode(c){return this.fromNode=c,this}withToNode(c){return this.toNode=c,this}withToIndex(c){return this.toIndex=c,this}},T})();var S=e(1052),a=e(19449),A=e(97809),t=e(18840),P=e(90850),U=e(4683),f=e(70822),O=e(71726),I=e(96105),L=e(45635),D=e(35811),m=e(91771);class G{constructor(s,c,p,R,l,N,B,M,z,E){this.wbsId=s,this.wbsRepository=c,this.userSettingsRepository=p,this.tasksRepository=R,this.configurationRepository=l,this.columnViewCommandService=N,this.treeCommandService=B,this.wbsActionProgressService=M,this.dropDestinationRepository=z,this.boxLocalStorageService=E,this.dataFetched$=a.C,this.selectedNodesIds=[],this.nodesSelected$=new A.t(1),this.currentWbsLayout$=new A.t(1),this.ready$=new t.X(!1),this.onDestroy$=new P.xQ}connectToStore(){const s=this.wbsRepository.getState(this.wbsId),c=this.userSettingsRepository.select(this.wbsId),p=this.tasksRepository.selectTasksState(this.wbsId),R=this.configurationRepository.selectConfigurationState(this.wbsId);this.treeGrid$=p.pipe((0,f.h)(l=>l&&l.fetched&&!l.fetching),(0,O.U)(l=>l.treeGrid)),this.wbsState$=s.pipe((0,I.x)((l,N)=>l.equals(N)),(0,L.b)(l=>this.wbsState=l)),this.userSettings$=c.pipe((0,L.b)(l=>this.userSettingsState=l)),this.configurationState$=R.pipe((0,L.b)(l=>this.configurationState=l)),this.tasks$=p,this.dataFetched$=(0,U.aj)(this.tasks$,this.wbsState$,this.userSettings$,this.configurationState$).pipe((0,O.U)(([l,N,B,M])=>l.fetched&&N.activeTaskFetched&&N.activeExternalTaskFetched&&N.activeBoxFetched&&B.fetched&&M.fetched),(0,I.x)()),this.wbsActionProgressService.isInProgress().pipe((0,D.R)(this.onDestroy$)).subscribe(l=>{this.actionInProgress=l})}initStore(){this.wbsRepository.initState(this.wbsId),this.userSettingsRepository.initState(this.wbsId)}destroy(){this.onDestroy$.next(),this.onDestroy$.complete()}selectActiveBoxId(){return this.wbsState$.pipe((0,f.h)(s=>s.activeBox),(0,O.U)(s=>s.activeBox.getId().toString()))}observeSelectedNodes(){const s=this.getTree();return this.nodesSelected$.pipe((0,O.U)(c=>s.getNodeById(c)))}fetchAllTasks(s){this.tasksRepository.fetchAllTasks(this.wbsId,s)}fetchTree(){return this.treeGrid$.pipe((0,O.U)(s=>s.nodes))}fetchNodesChildren(s){s.getTree().isLoaded(s)||this.tasksRepository.fetchNodesChildren(this.wbsId,this.wbsState.activeBox.getId().toString(),s.getId(),this.configurationState.configuration.maxNumberOfTasks)}fetchTasksWithFields(s){this.tasksRepository.fetchWithFields(this.wbsId,s)}getWbsId(){return this.wbsId}isDataFetched(){return this.dataFetched$}watchWbsState(){return this.wbsState$}getUserSettings(){return this.userSettings$}getConfigurationState(){return this.configurationState$}getTasksState(){return this.tasks$}setTreeId(s){this.treeId=s}setDependencies(s,c){this.tree=s,this.treeDispatcher=c,this.updateReady()}changeBox(s,c){this.boxLocalStorageService.setBoxId(s,c.getId()),this.wbsRepository.changeProgram(this.wbsId,c)}changeLayoutMode(s){this.userSettingsRepository.changeLayoutMode(this.wbsId,s)}refetchTasks(){this.wbsRepository.reFetchTasks(this.wbsId)}loadMore(){this.tasksRepository.fetchMoreTasks(this.wbsId)}expand(){this.userSettingsRepository.changeExpanded(this.wbsId,!0)}expandAll(){this.tree.expandAll(),this.tasksRepository.expandAll(this.wbsId),this.treeDispatcher.dispatch(new m.g8)}expandAllForTreeResolver(){this.tasksRepository.expandAll(this.wbsId)}collapse(){this.userSettingsRepository.changeExpanded(this.wbsId,!1)}collapseAll(){this.tree.collapseAll(),this.tasksRepository.collapseAll(this.wbsId),this.treeDispatcher.dispatch(new m.Ws)}collapseAllForTreeResolver(){this.tasksRepository.collapseAll(this.wbsId)}selectTasks(){return this.tasksRepository.selectTasksState(this.wbsId).pipe((0,O.U)(s=>s.tasks))}observeSelectedNodesIds(){return this.nodesSelected$}getTree(){return this.tree}changeLayout(s){this.changeTreeLayout(s),this.setWbsLayout(s)}changeTreeLayout(s){this.treeCommandService.setLayout(this.treeId,s)}setWbsLayout(s){this.currentWbsLayout$.next(s)}selectCurrentWbsLayout(){return this.currentWbsLayout$.asObservable()}deleteTask(){this.tasksRepository.deleteTask(this.wbsId,this.tree.getTreeId())}move(s,c,p){const R=(new g.Builder).withFromNode(s.map(l=>l)).withToNode(c).withToIndex(p).build();this.tasksRepository.move(this.wbsId,this.tree.getTreeId(),R)}moveUp(){if(this.actionInProgress)return;let s=this.getSelectedNodes();if(!S.v.canMoveUp(s)||(s=s.filter(p=>!p.getData().faded),0===s.length))return;const c=(new g.Builder).withFromNode(s.map(p=>p.getId())).withToNode(this.getSelectedNodesParent().getId()).withToIndex(Math.min(...this.getSelectedNodesNodeIndexes())-1).build();this.dropDestinationRepository.setDropDestination(this.tree),this.tasksRepository.move(this.wbsId,this.tree.getTreeId(),c),this.setActionInProgressStatus()}moveDown(){if(this.actionInProgress)return;let s=this.getSelectedNodes();if(!S.v.canMoveDown(s)||(s=s.filter(p=>!p.getData().faded),0===s.length))return;const c=(new g.Builder).withFromNode(s.map(p=>p.getId())).withToNode(this.getSelectedNodesParent().getId()).withToIndex(Math.max(...this.getSelectedNodesNodeIndexes())+2).build();this.dropDestinationRepository.setDropDestination(this.tree),this.tasksRepository.move(this.wbsId,this.tree.getTreeId(),c),this.setActionInProgressStatus()}indent(){if(this.actionInProgress)return;let s=this.getSelectedNodes();if(!S.v.canMoveRight(s)||(s=s.filter(l=>!l.getData().faded),0===s.length))return;const c=this.getSelectedNodesNodeIndexes(),p=this.getSelectedNodesParent().children.find(l=>l.nodeIndex===Math.min(...c)-1),R=(new g.Builder).withFromNode(s.map(l=>l.getId())).withToNode(p.getId()).withToIndex(p.children.length).build();p.isExpanded()||this.tree.clearExpandedNodeIndex(),this.dropDestinationRepository.setDropDestination(this.tree),this.tasksRepository.move(this.wbsId,this.tree.getTreeId(),R),this.setActionInProgressStatus()}outdent(){if(this.actionInProgress)return;let s=this.getSelectedNodes();if(!S.v.canMoveLeft(s)||(s=s.filter(R=>!R.getData().faded),0===s.length))return;const c=this.getSelectedNodesParent(),p=(new g.Builder).withFromNode(s.map(R=>R.getId())).withToNode(c.getParent().getId()).withToIndex(c.nodeIndex+1).build();this.dropDestinationRepository.setDropDestination(this.tree),this.tasksRepository.move(this.wbsId,this.tree.getTreeId(),p),this.setActionInProgressStatus()}sort(s,c,p){this.tasksRepository.sort(this.wbsId,{boxId:s,fieldId:c,ascSort:p})}whenReady(){return this.ready$.asObservable().pipe((0,f.h)(s=>s))}updateReady(){this.tree&&this.treeDispatcher&&this.ready$.next(!0)}changeSelectedColumnView(){this.refetchTasks()}commitChangesInColumnView(s){this.columnViewCommandService.commitChangesInColumnView(s)}discardChangesInColumnView(s){this.columnViewCommandService.discardChangesInColumnView(s)}openNode(s){this.tasksRepository.expandTask(this.wbsId,s.getId())}closeNode(s){this.tasksRepository.collapseTask(this.wbsId,s.getId())}selectTask(s){const c=this.tree.getNodeById(s);c&&this.tree.dispatchAction(new m.pP(c))}setSelectedNodesIds(s){this.selectedNodesIds=s,this.nodesSelected$.next(s)}setActionInProgressStatus(){this.wbsActionProgressService.inProgress()}getSelectedNodesParent(){return this.getSelectedNodes()[0].parent}getSelectedNodesNodeIndexes(){return this.getSelectedNodes().map(s=>s.nodeIndex)}getSelectedNodes(){return this.getTree().getNodeById(this.selectedNodesIds)}}},1052:(H,C,e)=>{e.d(C,{v:()=>y});class y{constructor(S){this.moveUp=y.canMoveUp(S),this.moveDown=y.canMoveDown(S),this.moveRight=y.canMoveRight(S),this.moveLeft=y.canMoveLeft(S)}static canMoveUp(S){if(!this.hasSameParent(S))return!1;const a=this.getNodeIndexes(S);return Math.min(...a)>0}static canMoveDown(S){if(!this.hasSameParent(S))return!1;const a=this.getParent(S),A=this.getNodeIndexes(S);return Math.max(...A)<a.children.length-1}static canMoveRight(S){if(!this.hasSameParent(S))return!1;const a=this.getNodeIndexes(S);return Math.min(...a)>0}static canMoveLeft(S){return this.hasSameParent(S)&&this.hasParent(S)}static hasSameParent(S){if(!S)return!1;const a=this.getParentIds(S);return 1===Array.from(new Set(a)).length}static hasParent(S){if(!S)return!1;const a=this.getParentIds(S);return!!Array.from(new Set(a))[0]}static getParentIds(S){return S.filter(a=>a.parent).map(a=>a.parent.id)}static getParent(S){return S.filter(a=>a.parent).map(a=>a.parent)[0]}static getNodeIndexes(S){return S.map(a=>a.nodeIndex)}}y.NEGATIVE=new y(null)}}]);